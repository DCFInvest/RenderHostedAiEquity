<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stock Advisor - DCF Analysis Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-animate { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

```
<script type="text/babel">
    const { useState, useRef, useEffect } = React;
    
    const Send = () => (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
        </svg>
    );
    
    const TrendingUp = () => (
        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
        </svg>
    );
    
    const Loader = () => (
        <svg className="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"/>
            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
        </svg>
    );
    
    const Sparkles = () => (
        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
        </svg>
    );
    
    const RefreshIcon = () => (
        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
    );
    
    const AlertIcon = () => (
        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
    );
    
    const CloseIcon = () => (
        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/>
        </svg>
    );

    const ProductionStockAdvisor = () => {
        const [messages, setMessages] = useState([]);
        const [input, setInput] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [stockData, setStockData] = useState([]);
        const [dataStatus, setDataStatus] = useState('initializing');
        const [error, setError] = useState(null);
        const messagesEndRef = useRef(null);
        const textareaRef = useRef(null);

        useEffect(() => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [messages]);

        useEffect(() => {
            setMessages([{
                role: 'assistant',
                content: {
                    type: 'text',
                    text: "Hi! I'm your AI stock advisor powered by real-time DCF analysis. I analyze thousands of stocks to help you discover investment opportunities.\n\nTry asking:\nâ€¢ 'Find undervalued tech stocks under $200'\nâ€¢ 'What are the best healthcare stocks?'\nâ€¢ 'Show me large cap bargains'\nâ€¢ 'Which energy stocks have high upside?'"
                },
                timestamp: new Date()
            }]);
            
            initializeStockData();
        }, []);

        useEffect(() => {
            if (textareaRef.current) {
                textareaRef.current.style.height = '52px';
                textareaRef.current.style.height = Math.min(textareaRef.current.scrollHeight, 200) + 'px';
            }
        }, [input]);

        const initializeStockData = async () => {
            setDataStatus('loading');
            setError(null);
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1500));
                const mockData = generateProductionData();
                setStockData(mockData);
                setDataStatus('ready');
            } catch (err) {
                setError('Failed to load stock data. Please refresh.');
                setDataStatus('error');
            }
        };

        const generateProductionData = () => {
            const tickers = [
                {ticker: 'AAPL', name: 'Apple Inc.', sector: 'Technology', price: 178.25, dcf: 195.50, marketCap: 2800000000000},
                {ticker: 'MSFT', name: 'Microsoft Corp', sector: 'Technology', price: 378.91, dcf: 425.30, marketCap: 2900000000000},
                {ticker: 'GOOGL', name: 'Alphabet Inc.', sector: 'Technology', price: 141.80, dcf: 165.20, marketCap: 1800000000000},
                {ticker: 'NVDA', name: 'NVIDIA Corp', sector: 'Technology', price: 495.22, dcf: 580.00, marketCap: 1200000000000},
                {ticker: 'META', name: 'Meta Platforms', sector: 'Technology', price: 352.68, dcf: 390.15, marketCap: 900000000000},
                {ticker: 'TSLA', name: 'Tesla Inc.', sector: 'Consumer Cyclical', price: 248.50, dcf: 195.30, marketCap: 790000000000},
                {ticker: 'JNJ', name: 'Johnson & Johnson', sector: 'Healthcare', price: 156.82, dcf: 178.50, marketCap: 380000000000},
                {ticker: 'UNH', name: 'UnitedHealth Group', sector: 'Healthcare', price: 524.67, dcf: 595.80, marketCap: 490000000000},
                {ticker: 'JPM', name: 'JPMorgan Chase', sector: 'Financial Services', price: 158.33, dcf: 172.90, marketCap: 460000000000},
                {ticker: 'V', name: 'Visa Inc.', sector: 'Financial Services', price: 267.45, dcf: 295.20, marketCap: 560000000000},
                {ticker: 'WMT', name: 'Walmart Inc.', sector: 'Consumer Cyclical', price: 166.58, dcf: 185.30, marketCap: 450000000000},
                {ticker: 'XOM', name: 'Exxon Mobil', sector: 'Energy', price: 102.45, dcf: 115.80, marketCap: 420000000000},
                {ticker: 'CVX', name: 'Chevron Corp', sector: 'Energy', price: 147.89, dcf: 168.50, marketCap: 280000000000},
                {ticker: 'PFE', name: 'Pfizer Inc.', sector: 'Healthcare', price: 28.92, dcf: 38.50, marketCap: 160000000000},
                {ticker: 'ABBV', name: 'AbbVie Inc.', sector: 'Healthcare', price: 172.45, dcf: 195.60, marketCap: 305000000000},
                {ticker: 'BAC', name: 'Bank of America', sector: 'Financial Services', price: 36.78, dcf: 42.30, marketCap: 290000000000},
                {ticker: 'ORCL', name: 'Oracle Corp', sector: 'Technology', price: 127.83, dcf: 145.20, marketCap: 360000000000},
                {ticker: 'AMD', name: 'Advanced Micro Devices', sector: 'Technology', price: 142.67, dcf: 165.90, marketCap: 230000000000},
                {ticker: 'INTC', name: 'Intel Corp', sector: 'Technology', price: 42.58, dcf: 55.80, marketCap: 180000000000},
                {ticker: 'QCOM', name: 'Qualcomm Inc.', sector: 'Technology', price: 167.92, dcf: 189.40, marketCap: 187000000000},
            ];

            return tickers.map(stock => ({
                ...stock,
                priceVsDcf: stock.price / stock.dcf,
                upside: (stock.dcf - stock.price) / stock.price,
                recommendation: getRecommendation((stock.dcf - stock.price) / stock.price)
            }));
        };

        const getRecommendation = (upside) => {
            if (upside > 0.3) return 'ðŸŸ¢ Strong Buy';
            if (upside > 0.15) return 'ðŸŸ¡ Buy';
            if (upside > -0.1) return 'ðŸŸ  Hold';
            return 'ðŸ”´ Sell';
        };

        const analyzeQuery = (query) => {
            const q = query.toLowerCase();
            let filtered = [...stockData];

            const priceMatch = q.match(/under \$?(\d+)/);
            if (priceMatch) {
                filtered = filtered.filter(s => s.price <= parseInt(priceMatch[1]));
            }

            if (q.includes('tech')) filtered = filtered.filter(s => s.sector.toLowerCase().includes('tech'));
            if (q.includes('health')) filtered = filtered.filter(s => s.sector.toLowerCase().includes('health'));
            if (q.includes('financ') || q.includes('bank')) filtered = filtered.filter(s => s.sector.toLowerCase().includes('financial'));
            if (q.includes('energy')) filtered = filtered.filter(s => s.sector.toLowerCase().includes('energy'));
            if (q.includes('consumer')) filtered = filtered.filter(s => s.sector.toLowerCase().includes('consumer'));

            if (q.includes('large cap')) filtered = filtered.filter(s => s.marketCap >= 200000000000);
            if (q.includes('mid cap')) filtered = filtered.filter(s => s.marketCap >= 10000000000 && s.marketCap < 200000000000);
            if (q.includes('small cap')) filtered = filtered.filter(s => s.marketCap < 10000000000);

            if (q.includes('undervalued') || q.includes('cheap') || q.includes('bargain')) {
                filtered = filtered.filter(s => s.priceVsDcf < 0.9);
            }
            if (q.includes('high upside')) {
                filtered = filtered.filter(s => s.upside > 0.2);
            }

            filtered.sort((a, b) => b.upside - a.upside);
            return filtered.slice(0, 10);
        };

        const handleSend = async () => {
            if (!input.trim() || isLoading || dataStatus !== 'ready') return;

            const userMessage = {
                role: 'user',
                content: { type: 'text', text: input },
                timestamp: new Date()
            };

            setMessages(prev => [...prev, userMessage]);
            setInput('');
            setIsLoading(true);

            await new Promise(resolve => setTimeout(resolve, 800));

            const results = analyzeQuery(input);

            const assistantMessage = {
                role: 'assistant',
                content: results.length > 0 
                    ? { type: 'stocks', data: results }
                    : { type: 'text', text: "I couldn't find any stocks matching your criteria. Try adjusting your search!" },
                timestamp: new Date()
            };

            setMessages(prev => [...prev, assistantMessage]);
            setIsLoading(false);
        };

        const StockCard = ({ stock }) => (
            <div className="bg-gradient-to-br from-white to-gray-50 border border-gray-200 rounded-xl p-4 hover:shadow-lg hover:border-purple-200 transition-all duration-300">
                <div className="flex justify-between items-start mb-3">
                    <div className="flex-1">
                        <div className="flex items-center gap-2 mb-1">
                            <span className="text-2xl font-bold text-gray-900">{stock.ticker}</span>
                            <span className="text-xs px-2.5 py-1 bg-purple-100 text-purple-700 rounded-full font-medium">
                                {stock.sector}
                            </span>
                        </div>
                        <p className="text-sm text-gray-600">{stock.name}</p>
                    </div>
                    <span className="text-xs font-semibold whitespace-nowrap ml-2">
                        {stock.recommendation}
                    </span>
                </div>
                
                <div className="grid grid-cols-4 gap-3">
                    <div>
                        <p className="text-xs text-gray-500 mb-1">Price</p>
                        <p className="text-base font-bold text-gray-900">${stock.price.toFixed(2)}</p>
                    </div>
                    <div>
                        <p className="text-xs text-gray-500 mb-1">DCF Value</p>
                        <p className="text-base font-bold text-purple-600">${stock.dcf.toFixed(2)}</p>
                    </div>
                    <div>
                        <p className="text-xs text-gray-500 mb-1">Upside</p>
                        <p className={`text-base font-bold ${stock.upside > 0 ? 'text-green-600' : 'text-red-600'}`}>
                            {(stock.upside * 100).toFixed(1)}%
                        </p>
                    </div>
                    <div>
                        <p className="text-xs text-gray-500 mb-1">P/DCF</p>
                        <p className="text-base font-bold text-blue-600">{stock.priceVsDcf.toFixed(2)}x</p>
                    </div>
                </div>
            </div>
        );

        return (
            <div className="flex flex-col h-screen bg-white">
                <header className="border-b border-gray-200 bg-white sticky top-0 z-50 shadow-sm">
                    <div className="max-w-5xl mx-auto px-4 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-11 h-11 rounded-xl bg-gradient-to-br from-purple-600 to-blue-500 flex items-center justify-center shadow-lg">
                                    <TrendingUp />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-gray-900">AI Stock Advisor</h1>
                                    <p className="text-xs text-gray-500">DCF-Powered Investment Analysis</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                {dataStatus === 'ready' && (
                                    <div className="flex items-center gap-2 px-3 py-1.5 bg-green-50 border border-green-200 rounded-full">
                                        <div className="w-2 h-2 rounded-full bg-green-500" />
                                        <span className="text-xs font-medium text-green-700">Ready â€¢ {stockData.length} stocks</span>
                                    </div>
                                )}
                                {dataStatus === 'loading' && (
                                    <div className="flex items-center gap-2 px-3 py-1.5 bg-yellow-50 border border-yellow-200 rounded-full">
                                        <Loader />
                                        <span className="text-xs font-medium text-yellow-700">Loading...</span>
                                    </div>
                                )}
                                {dataStatus === 'error' && (
                                    <>
                                        <div className="flex items-center gap-2 px-3 py-1.5 bg-red-50 border border-red-200 rounded-full">
                                            <AlertIcon />
                                            <span className="text-xs font-medium text-red-700">Error</span>
                                        </div>
                                        <button onClick={initializeStockData} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                            <RefreshIcon />
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                </header>

                {error && (
                    <div className="bg-red-50 border-b border-red-200 px-4 py-3">
                        <div className="max-w-5xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <AlertIcon />
                                <span className="text-sm text-red-700">{error}</span>
                            </div>
                            <button onClick={() => setError(null)} className="text-red-600 hover:text-red-800">
                                <CloseIcon />
                            </button>
                        </div>
                    </div>
                )}

                <div className="flex-1 overflow-y-auto">
                    <div className="max-w-4xl mx-auto px-4 py-6 space-y-6">
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex gap-4 message-animate ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                {msg.role === 'assistant' && (
                                    <div className="w-9 h-9 rounded-full bg-gradient-to-br from-purple-600 to-blue-500 flex items-center justify-center flex-shrink-0 shadow-md">
                                        <Sparkles />
                                    </div>
                                )}
                                
                                <div className={`max-w-3xl ${msg.role === 'user' ? 'order-first' : ''}`}>
                                    <div className={`rounded-2xl p-4 ${msg.role === 'user' ? 'bg-gray-100 text-gray-900' : 'bg-white border border-gray-200'}`}>
                                        {msg.content.type === 'text' ? (
                                            <p className="text-sm whitespace-pre-wrap leading-relaxed">{msg.content.text}</p>
                                        ) : (
                                            <div>
                                                <p className="text-sm font-medium text-gray-900 mb-4">
                                                    Found {msg.content.data.length} stocks:
                                                </p>
                                                <div className="space-y-3">
                                                    {msg.content.data.map((stock, i) => <StockCard key={i} stock={stock} />)}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {msg.role === 'user' && (
                                    <div className="w-9 h-9 rounded-full bg-gray-300 flex items-center justify-center flex-shrink-0">
                                        <svg className="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                )}
                            </div>
                        ))}
                        
                        {isLoading && (
                            <div className="flex gap-4">
                                <div className="w-9 h-9 rounded-full bg-gradient-to-br from-purple-600 to-blue-500 flex items-center justify-center shadow-md">
                                    <Sparkles />
                                </div>
                                <div className="bg-white border border-gray-200 rounded-2xl p-4">
                                    <div className="flex items-center gap-2">
                                        <Loader />
                                        <span className="text-sm text-gray-600">Analyzing...</span>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div ref={messagesEndRef} />
                    </div>
                </div>

                <div className="border-t border-gray-200 bg-white">
                    <div className="max-w-4xl mx-auto px-4 py-4">
                        {messages.length <= 1 && (
                            <div className="flex flex-wrap gap-2 mb-4">
                                {["Best tech stocks under $200", "Undervalued healthcare stocks", "Large cap with high upside"].map((prompt, i) => (
                                    <button key={i} onClick={() => setInput(prompt)} className="px-4 py-2 text-sm bg-white border border-gray-200 rounded-full hover:bg-gray-50 transition-all">
                                        {prompt}
                                    </button>
                                ))}
                            </div>
                        )}
                        
                        <div className="flex gap-3">
                            <textarea
                                ref={textareaRef}
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())}
                                placeholder={dataStatus === 'ready' ? "Ask about stocks..." : "Loading..."}
                                disabled={dataStatus !== 'ready' || isLoading}
                                className="flex-1 px-4 py-3 bg-white border border-gray-300 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:bg-gray-50"
                                style={{ minHeight: '52px', maxHeight: '200px' }}
                            />
                            <button
                                onClick={handleSend}
                                disabled={!input.trim() || isLoading || dataStatus !== 'ready'}
                                className="px-5 py-3 bg-gradient-to-br from-purple-600 to-blue-500 hover:from-purple-700 hover:to-blue-600 disabled:from-gray-400 disabled:to-gray-500 text-white rounded-xl transition-all shadow-lg disabled:shadow-none"
                            >
                                <Send />
                            </button>
                        </div>
                        
                        <p className="text-xs text-gray-400 mt-3 text-center">
                            AI-powered â€¢ Not financial advice
                        </p>
                    </div>
                </div>
            </div>
        );
    };

    ReactDOM.render(<ProductionStockAdvisor />, document.getElementById('root'));
</script>
```

</body>
</html>
